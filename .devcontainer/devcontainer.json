{
  "name": "netbrain-zwift-devcontainer",
  "image": "mcr.microsoft.com/devcontainers/base:debian",
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker": {
      "installDockerBuildx": true,
      "moby": false
    },
    "ghcr.io/devcontainers/features/nix": {
      "extraNixConfig": "experimental-features = nix-command flakes"
    }
  },
  "overrideFeatureInstallOrder": [
    "ghcr.io/devcontainers/features/docker-in-docker",
    "ghcr.io/devcontainers/features/nix"
  ],
  "customizations": {
    "vscode": {
      "extensions": [
        "DavidAnson.vscode-markdownlint",
        "docker.docker",
        "editorconfig.editorconfig",
        "exiasr.hadolint",
        "foxundermoon.shell-format",
        "jnoortheen.nix-ide",
        "kennylong.kubernetes-yaml-formatter",
        "ms-azuretools.vscode-containers",
        "redhat.vscode-yaml",
        "streetsidesoftware.code-spell-checker",
        "timonwong.shellcheck"
      ],
      "settings": {
        "nix.enableLanguageServer": true,
        "nix.serverPath": "nil",
        "nix.serverSettings.formatting.command": [
          "nixfmt"
        ],
        "yaml.format.enable": false,
        "better-yaml.directives": true,
        "better-yaml.indentSeq": false,
        "better-yaml.lineWidth": 128
      }
    }
  },
  "postCreateCommand": "if ! docker info > /dev/null 2>&1; then sudo update-alternatives --set iptables /usr/sbin/iptables-nft; fi",
  "postAttachCommand": "sleep 5 && nix develop",
  "remoteUser": "vscode"
}
